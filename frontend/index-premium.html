<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blueshift Observatory - Premium Dashboard</title>
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f1f5f9;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Premium Design System Colors & Variables */
    :root {
      --gradient-primary: linear-gradient(135deg, #2563eb, #1d4ed8);
      --gradient-header: linear-gradient(135deg, #1e3a5f 0%, #2563eb 50%, #3b82f6 100%);
      --gradient-sidebar: linear-gradient(180deg, #0b1929 0%, #152e4d 50%, #1e4976 100%);

      --color-green: #10b981;
      --color-yellow: #f59e0b;
      --color-orange: #f97316;
      --color-red: #ef4444;
      --color-blue: #3b82f6;
      --color-purple: #8b5cf6;

      --shadow-sm: 0 1px 4px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);

      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    /* App Layout */
    .app-container {
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: var(--gradient-sidebar);
      color: #fff;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.3s ease;
      overflow: hidden;
    }

    .sidebar.collapsed {
      width: 64px;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-logo-icon {
      width: 32px;
      height: 32px;
      background: var(--gradient-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .sidebar-logo-icon span {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
    }

    .sidebar-logo-text p {
      margin: 0;
      font-size: 14px;
      font-weight: 800;
    }

    .sidebar-logo-text p:last-child {
      font-size: 11px;
      opacity: 0.6;
    }

    .sidebar.collapsed .sidebar-logo-text {
      display: none;
    }

    .sidebar-nav {
      flex: 1;
      padding: 12px 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: rgba(255, 255, 255, 0.6);
      font-size: 13px;
      font-weight: 400;
      cursor: pointer;
      text-align: left;
      transition: all 0.15s;
      width: 100%;
    }

    .nav-item:hover {
      background: rgba(59, 130, 246, 0.1);
      color: rgba(255, 255, 255, 0.9);
    }

    .nav-item.active {
      background: rgba(59, 130, 246, 0.2);
      color: #fff;
      font-weight: 600;
    }

    .nav-item svg {
      flex-shrink: 0;
      opacity: 0.7;
    }

    .nav-item.active svg {
      opacity: 1;
    }

    .nav-item-text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar.collapsed .nav-item-text {
      display: none;
    }

    .nav-item-indicator {
      margin-left: auto;
      width: 6px;
      height: 6px;
      background: #3b82f6;
      border-radius: 50%;
    }

    .sidebar.collapsed .nav-item-indicator {
      display: none;
    }

    .sidebar-footer {
      padding: 12px 8px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .collapse-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      font-size: 12px;
    }

    .collapse-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      overflow: auto;
      padding: 24px 28px;
    }

    /* Page Header Component */
    .page-header {
      background: var(--gradient-header);
      border-radius: var(--radius-lg);
      padding: 28px 32px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .page-header-orb-1 {
      position: absolute;
      top: -40px;
      right: -40px;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
      border-radius: 50%;
    }

    .page-header-orb-2 {
      position: absolute;
      bottom: -20px;
      left: 30%;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
      border-radius: 50%;
    }

    .page-header-content {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      z-index: 1;
    }

    .page-header-icon {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .page-header-title {
      color: #fff;
      font-size: 22px;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .page-header-subtitle {
      color: rgba(255,255,255,0.7);
      font-size: 13px;
      margin: 4px 0 0;
    }

    /* Control Panel */
    .control-panel {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .control-group {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .control-label {
      color: #94a3b8;
    }

    .control-value {
      font-weight: 600;
      color: #334155;
    }

    .btn {
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: #fff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    .btn-secondary {
      background: #fff;
      color: #475569;
      border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover {
      background: #f8fafc;
    }

    .btn-success {
      background: var(--color-green);
      color: #fff;
    }

    .date-input {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 13px;
      color: #475569;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }

    .stat-card {
      border-radius: 14px;
      padding: 20px 22px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card-healthy {
      background: linear-gradient(135deg, #ecfdf5, #d1fae5);
      border-left: 4px solid var(--color-green);
    }

    .stat-card-monitor {
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
      border-left: 4px solid var(--color-yellow);
    }

    .stat-card-low {
      background: linear-gradient(135deg, #fff7ed, #fed7aa);
      border-left: 4px solid var(--color-orange);
    }

    .stat-card-critical {
      background: linear-gradient(135deg, #fef2f2, #fecaca);
      border-left: 4px solid var(--color-red);
    }

    .stat-card-icon-badge {
      position: absolute;
      top: 12px;
      right: 14px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
    }

    .stat-card-healthy .stat-card-icon-badge { background: var(--color-green); }
    .stat-card-monitor .stat-card-icon-badge { background: var(--color-yellow); }
    .stat-card-low .stat-card-icon-badge { background: var(--color-orange); }
    .stat-card-critical .stat-card-icon-badge { background: var(--color-red); }

    .stat-card-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.06em;
      margin: 0 0 6px;
      text-transform: uppercase;
    }

    .stat-card-healthy .stat-card-label { color: var(--color-green); }
    .stat-card-monitor .stat-card-label { color: var(--color-yellow); }
    .stat-card-low .stat-card-label { color: var(--color-orange); }
    .stat-card-critical .stat-card-label { color: var(--color-red); }

    .stat-card-value {
      font-size: 36px;
      font-weight: 800;
      color: #1e293b;
      margin: 0 0 4px;
      line-height: 1;
    }

    .stat-card-subtitle {
      font-size: 12px;
      color: #64748b;
      margin: 0;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 20px;
      background: #f1f5f9;
      border-radius: 12px;
      padding: 4px;
    }

    .tab {
      padding: 9px 18px;
      border-radius: 9px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: #64748b;
      transition: all 0.2s;
    }

    .tab.active {
      background: #fff;
      color: #1e40af;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    }

    /* Card Section */
    .card-section {
      background: #fff;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .card-header {
      padding: 16px 22px;
      border-bottom: 1px solid #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
      color: #1e293b;
      margin: 0;
    }

    .card-meta {
      font-size: 12px;
      color: #94a3b8;
    }

    /* Data Table */
    .table-wrapper {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      min-width: 1200px;
    }

    .data-table thead tr {
      background: #f8fafc;
    }

    .data-table th {
      padding: 12px 14px;
      text-align: left;
      font-weight: 700;
      font-size: 11px;
      color: #64748b;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border-bottom: 2px solid #e2e8f0;
      cursor: pointer;
      user-select: none;
    }

    .data-table th:hover {
      background: #f1f5f9;
    }

    .data-table td {
      padding: 14px;
      font-feature-settings: 'tnum';
      border-bottom: 1px solid #f1f5f9;
    }

    .data-table tbody tr {
      transition: background 0.15s;
    }

    .data-table tbody tr:hover {
      background: #f8fafc;
    }

    /* Badges */
    .badge {
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: inline-block;
      white-space: nowrap;
    }

    .badge-region-us {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #eff6ff;
      color: #1e40af;
    }

    .badge-region-eu {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #f0fdf4;
      color: #166534;
    }

    .badge-esp-sendgrid {
      background: linear-gradient(135deg, #1A82E2, #1565C0);
      color: #fff;
    }

    .badge-esp-sparkpost {
      background: linear-gradient(135deg, #FF6600, #E65100);
      color: #fff;
    }

    .badge-esp-mailgun {
      background: linear-gradient(135deg, #D4463B, #B71C1C);
      color: #fff;
    }

    /* Progress Ring */
    .progress-ring-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .progress-value {
      font-weight: 700;
    }

    .progress-value-excellent { color: var(--color-green); }
    .progress-value-good { color: var(--color-yellow); }
    .progress-value-poor { color: var(--color-red); }

    /* Domain Link */
    .domain-link {
      font-weight: 600;
      color: #1e40af;
      cursor: pointer;
      text-decoration: none;
    }

    .domain-link:hover {
      text-decoration: underline;
    }

    /* Loading State */
    .loading-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Utility Classes */
    .text-mono {
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    }

    .text-center {
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 64px;
      }

      .sidebar-logo-text,
      .nav-item-text,
      .nav-item-indicator {
        display: none;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-container">
      <!-- Sidebar -->
      <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <div class="sidebar-logo-icon">
              <span>B</span>
            </div>
            <div class="sidebar-logo-text">
              <p>Blueshift</p>
              <p>Observatory</p>
            </div>
          </div>
        </div>

        <nav class="sidebar-nav">
          <button
            v-for="page in pages"
            :key="page.key"
            class="nav-item"
            :class="{ active: activePage === page.key }"
            @click="activePage = page.key"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" v-html="page.icon"></svg>
            <span class="nav-item-text">{{ page.label }}</span>
            <span v-if="activePage === page.key" class="nav-item-indicator"></span>
          </button>
        </nav>

        <div class="sidebar-footer">
          <button class="collapse-btn" @click="sidebarCollapsed = !sidebarCollapsed">
            {{ sidebarCollapsed ? '‚Üí' : '‚Üê Collapse' }}
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Pulsation Page -->
        <div v-if="activePage === 'pulsation'">
          <!-- Page Header -->
          <div class="page-header">
            <div class="page-header-orb-1"></div>
            <div class="page-header-orb-2"></div>
            <div class="page-header-content">
              <div class="page-header-icon">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>
              </div>
              <div>
                <h1 class="page-header-title">Pulsation ‚Äî Deliverability Health Monitor</h1>
                <p class="page-header-subtitle">Real-time monitoring of domain health with historical trends and intelligent risk classification</p>
              </div>
            </div>
          </div>

          <!-- Control Panel -->
          <div class="control-panel">
            <div class="control-group">
              <span class="control-label">üìÖ</span>
              <span class="control-value">{{ pulsationViewType === 'yesterday' ? 'Yesterday' : pulsationViewType === '7day' ? 'Last 7 Days' : 'Last 30 Days' }}</span>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </div>

            <button class="btn btn-primary" @click="fetchPulsationData" :disabled="pulsationLoading">
              <span v-if="pulsationLoading">‚è≥</span>
              <span v-else>üîÑ</span>
              {{ pulsationLoading ? 'Loading...' : 'Load Data' }}
            </button>

            <button class="btn btn-secondary" @click="collectYesterdayData" :disabled="pulsationLoading">
              üì• Collect Yesterday
            </button>

            <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
              <input type="date" class="date-input" v-model="pulsationCustomCollectDate" :disabled="pulsationLoading" />
              <button class="btn btn-secondary" @click="collectCustomDate" :disabled="pulsationLoading">
                Collect Custom Date
              </button>
            </div>
          </div>

          <!-- Stats Grid -->
          <div v-if="pulsationData" class="stats-grid">
            <div class="stat-card stat-card-healthy" v-if="pulsationData.classification_counts['Green (Healthy)']">
              <div class="stat-card-icon-badge">‚úì</div>
              <p class="stat-card-label">HEALTHY DOMAINS</p>
              <p class="stat-card-value">
                <AnimNum :target="pulsationData.classification_counts['Green (Healthy)'] || 0" />
              </p>
              <p class="stat-card-subtitle">Excellent Performance</p>
            </div>

            <div class="stat-card stat-card-monitor" v-if="pulsationData.classification_counts['Yellow (Monitor)']">
              <div class="stat-card-icon-badge">‚ö†</div>
              <p class="stat-card-label">MONITOR REQUIRED</p>
              <p class="stat-card-value">
                <AnimNum :target="pulsationData.classification_counts['Yellow (Monitor)'] || 0" />
              </p>
              <p class="stat-card-subtitle">Needs Attention</p>
            </div>

            <div class="stat-card stat-card-low" v-if="pulsationData.classification_counts['Orange (Low Delivery)']">
              <div class="stat-card-icon-badge">!</div>
              <p class="stat-card-label">LOW DELIVERY</p>
              <p class="stat-card-value">
                <AnimNum :target="pulsationData.classification_counts['Orange (Low Delivery)'] || 0" />
              </p>
              <p class="stat-card-subtitle">Action Required</p>
            </div>

            <div class="stat-card stat-card-critical" v-if="pulsationData.classification_counts['Red (High Spam Complaints)']">
              <div class="stat-card-icon-badge">‚úï</div>
              <p class="stat-card-label">HIGH SPAM RISK</p>
              <p class="stat-card-value">
                <AnimNum :target="pulsationData.classification_counts['Red (High Spam Complaints)'] || 0" />
              </p>
              <p class="stat-card-subtitle">Critical Issue</p>
            </div>
          </div>

          <!-- Tabs -->
          <div v-if="pulsationData" class="tabs">
            <button class="tab" :class="{ active: pulsationTab === 'overall' }" @click="pulsationTab = 'overall'">
              Overall
            </button>
            <button class="tab" :class="{ active: pulsationTab === 'low_delivery' }" @click="pulsationTab = 'low_delivery'">
              Top 20 Low Delivery
            </button>
            <button class="tab" :class="{ active: pulsationTab === 'spam' }" @click="pulsationTab = 'spam'">
              Top 20 Spam
            </button>
            <button class="tab" :class="{ active: pulsationTab === 'bounce' }" @click="pulsationTab = 'bounce'">
              Top 20 Bounce
            </button>
            <button class="tab" :class="{ active: pulsationTab === 'risk' }" @click="pulsationTab = 'risk'">
              Top 20 Risk
            </button>
            <button class="tab" :class="{ active: pulsationTab === 'charts' }" @click="pulsationTab = 'charts'">
              Trend
            </button>
          </div>

          <!-- Overall Tab -->
          <div v-if="pulsationData && pulsationTab === 'overall'" class="card-section">
            <div class="card-header">
              <h3 class="card-title">Overall <span style="color: #94a3b8; font-weight: 400;">(Sent > 0)</span></h3>
              <span class="card-meta">{{ filteredOverallData.length }} domains</span>
            </div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th @click="sortTable('Region')">Region</th>
                    <th @click="sortTable('From_domain')">Domain</th>
                    <th @click="sortTable('ESP')">ESP</th>
                    <th @click="sortTable('Sent')">Sent</th>
                    <th @click="sortTable('Delivered')">Delivered</th>
                    <th @click="sortTable('delivery_rate')">Delivery %</th>
                    <th @click="sortTable('soft_bounce_pct')">Soft Bounce %</th>
                    <th @click="sortTable('Spam_report')">Spam</th>
                    <th @click="sortTable('spam_rate')">Spam %</th>
                    <th>7d Trend</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(row, idx) in filteredOverallData" :key="idx">
                    <td>
                      <span class="badge" :class="row.Region === 'US' ? 'badge-region-us' : 'badge-region-eu'">
                        {{ row.Region === 'US' ? 'üá∫üá∏' : 'üá™üá∫' }} {{ row.Region }}
                      </span>
                    </td>
                    <td>
                      <span class="domain-link">{{ row.From_domain }}</span>
                    </td>
                    <td>
                      <span class="badge" :class="getESPBadgeClass(row.ESP)">{{ row.ESP }}</span>
                    </td>
                    <td class="text-mono">{{ formatNumber(row.Sent) }}</td>
                    <td class="text-mono">{{ formatNumber(row.Delivered) }}</td>
                    <td>
                      <div class="progress-ring-wrapper">
                        <svg width="30" height="30" style="transform: rotate(-90deg)">
                          <circle cx="15" cy="15" r="12" fill="none" stroke="#e5e7eb" stroke-width="3" />
                          <circle
                            cx="15"
                            cy="15"
                            r="12"
                            fill="none"
                            :stroke="getProgressColor(row.delivery_rate)"
                            stroke-width="3"
                            :stroke-dasharray="75.4"
                            :stroke-dashoffset="75.4 - (row.delivery_rate / 100) * 75.4"
                            stroke-linecap="round"
                            style="transition: stroke-dashoffset 0.8s ease"
                          />
                        </svg>
                        <span class="progress-value" :class="getProgressClass(row.delivery_rate)">
                          {{ formatRate(row.delivery_rate) }}%
                        </span>
                      </div>
                    </td>
                    <td class="text-mono">{{ formatRate(row.soft_bounce_pct) }}%</td>
                    <td class="text-mono">{{ formatNumber(row.Spam_report) }}</td>
                    <td class="text-mono">{{ formatRate(row.spam_rate) }}%</td>
                    <td>
                      <svg width="80" height="24" style="display: block">
                        <polyline
                          :points="generateSparklinePoints([95, 96, 97, 96, 95])"
                          fill="none"
                          :stroke="getProgressColor(row.delivery_rate)"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Empty State -->
          <div v-if="!pulsationData" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
            <h3 style="font-size: 18px; color: #1e293b; margin-bottom: 8px;">No Data Loaded</h3>
            <p style="font-size: 14px; color: #64748b; margin-bottom: 24px;">Click "Load Data" to fetch pulsation metrics</p>
          </div>
        </div>

        <!-- Placeholder for other pages -->
        <div v-if="activePage !== 'pulsation'" style="text-align: center; padding: 60px 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">üöß</div>
          <h3 style="font-size: 18px; color: #1e293b; margin-bottom: 8px;">Page Under Construction</h3>
          <p style="font-size: 14px; color: #64748b;">This page will be available soon with the premium design</p>
        </div>
      </div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    const { createApp } = Vue;

    createApp({
      components: {
        // Animated Number Counter Component
        AnimNum: {
          props: {
            target: {
              type: Number,
              required: true,
              default: 0
            },
            duration: {
              type: Number,
              default: 1000
            }
          },
          data() {
            return {
              displayValue: '0'
            };
          },
          watch: {
            target: {
              immediate: true,
              handler(newTarget) {
                this.animateValue(newTarget);
              }
            }
          },
          methods: {
            animateValue(target) {
              if (this.animationFrame) {
                cancelAnimationFrame(this.animationFrame);
              }

              let startTime = null;
              const startValue = 0;

              const step = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / this.duration, 1);
                const currentValue = Math.floor(progress * target);
                this.displayValue = currentValue.toLocaleString();

                if (progress < 1) {
                  this.animationFrame = requestAnimationFrame(step);
                }
              };

              this.animationFrame = requestAnimationFrame(step);
            }
          },
          beforeUnmount() {
            if (this.animationFrame) {
              cancelAnimationFrame(this.animationFrame);
            }
          },
          template: '<span>{{ displayValue }}</span>'
        }
      },
      data() {
        return {
          // API Configuration - always use port 8001 for backend
          API_BASE: 'http://localhost:8001',

          // UI State
          sidebarCollapsed: false,
          activePage: 'pulsation',
          pages: [
            { key: 'pulsation', label: 'Pulsation', icon: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>' },
            { key: 'mbr', label: 'MBR Deliverability', icon: '<path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>' },
            { key: 'mappings', label: 'Account Mappings', icon: '<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>' },
            { key: 'info', label: 'Account Info', icon: '<rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/>' },
            { key: 'snds', label: 'SNDS', icon: '<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>' },
            { key: 'gpt', label: 'GPT', icon: '<rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8l6 4 6-4"/>' },
            { key: 'bounces', label: 'Bounce Analytics', icon: '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>' },
            { key: 'updates', label: 'Industry Updates', icon: '<path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/>' }
          ],

          // Pulsation State
          pulsationLoading: false,
          pulsationData: null,
          pulsationTab: 'overall',
          pulsationViewType: 'yesterday',
          pulsationCustomCollectDate: '',
          sortColumn: null,
          sortOrder: 'asc'
        };
      },
      computed: {
        filteredOverallData() {
          if (!this.pulsationData || !this.pulsationData.overall_data) return [];

          let data = this.pulsationData.overall_data.filter(row => row.Sent > 0);

          if (this.sortColumn) {
            data = [...data].sort((a, b) => {
              const aVal = a[this.sortColumn];
              const bVal = b[this.sortColumn];

              if (typeof aVal === 'number' && typeof bVal === 'number') {
                return this.sortOrder === 'asc' ? aVal - bVal : bVal - aVal;
              }

              const aStr = String(aVal).toLowerCase();
              const bStr = String(bVal).toLowerCase();
              return this.sortOrder === 'asc'
                ? aStr.localeCompare(bStr)
                : bStr.localeCompare(aStr);
            });
          }

          return data;
        }
      },
      methods: {
        async fetchPulsationData() {
          this.pulsationLoading = true;
          try {
            // Correct API: POST /api/pulsation/query with body
            const response = await fetch(`${this.API_BASE}/api/pulsation/query`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                view_type: this.pulsationViewType
              })
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`Failed to fetch data: ${response.status} ${errorText}`);
            }

            const result = await response.json();

            if (result.status === 'no_data') {
              alert(result.message || 'No data available for the selected period');
              this.pulsationData = null;
            } else {
              this.pulsationData = result;
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Failed to load pulsation data: ' + error.message);
          } finally {
            this.pulsationLoading = false;
          }
        },
        async collectYesterdayData() {
          this.pulsationLoading = true;
          try {
            // Correct API: POST /api/pulsation/collect-yesterday
            const response = await fetch(`${this.API_BASE}/api/pulsation/collect-yesterday`, {
              method: 'POST'
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`Failed to collect data: ${response.status} ${errorText}`);
            }

            const result = await response.json();
            alert(result.message || 'Data collection started. This may take a few minutes.');

            // Refresh data
            await this.fetchPulsationData();
          } catch (error) {
            console.error('Error:', error);
            alert('Failed to collect data: ' + error.message);
          } finally {
            this.pulsationLoading = false;
          }
        },
        async collectCustomDate() {
          if (!this.pulsationCustomCollectDate) {
            alert('Please select a date');
            return;
          }
          this.pulsationLoading = true;
          try {
            // Correct API: POST /api/pulsation/collect-date?date=YYYY-MM-DD
            const response = await fetch(`${this.API_BASE}/api/pulsation/collect-date?date=${this.pulsationCustomCollectDate}`, {
              method: 'POST'
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`Failed to collect data: ${response.status} ${errorText}`);
            }

            const result = await response.json();
            alert(result.message || 'Data collection completed!');

            // Refresh data
            await this.fetchPulsationData();
          } catch (error) {
            console.error('Error:', error);
            alert('Failed to collect data: ' + error.message);
          } finally {
            this.pulsationLoading = false;
          }
        },
        sortTable(column) {
          if (this.sortColumn === column) {
            this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';
          } else {
            this.sortColumn = column;
            this.sortOrder = 'asc';
          }
        },
        formatNumber(num) {
          if (num === null || num === undefined) return '0';
          return new Intl.NumberFormat().format(num);
        },
        formatRate(rate) {
          if (rate === null || rate === undefined) return '0.00';
          return typeof rate === 'number' ? rate.toFixed(2) : rate;
        },
        getESPBadgeClass(esp) {
          const espLower = esp.toLowerCase();
          if (espLower.includes('send')) return 'badge-esp-sendgrid';
          if (espLower.includes('spark')) return 'badge-esp-sparkpost';
          return 'badge-esp-mailgun';
        },
        getProgressColor(rate) {
          if (rate >= 95) return '#10b981';
          if (rate >= 85) return '#f59e0b';
          return '#ef4444';
        },
        getProgressClass(rate) {
          if (rate >= 95) return 'progress-value-excellent';
          if (rate >= 85) return 'progress-value-good';
          return 'progress-value-poor';
        },
        generateSparklinePoints(data) {
          const width = 80;
          const height = 24;
          const max = Math.max(...data);
          const min = Math.min(...data);
          const range = max - min || 1;

          return data.map((v, i) => {
            const x = (i / (data.length - 1)) * width;
            const y = height - ((v - min) / range) * (height - 4) - 2;
            return `${x},${y}`;
          }).join(' ');
        }
      },
      mounted() {
        // Auto-load data on mount
        this.fetchPulsationData();
      }
    }).mount('#app');
  </script>
</body>
</html>
